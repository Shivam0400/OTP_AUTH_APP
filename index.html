<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#4facfe">

<link rel="apple-touch-icon" href="icon-192.png">
<meta charset="UTF-8">
<title>OTP Login</title>
<link rel="icon" type="image/png" href="login.png">


<style>

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Segoe UI',sans-serif;
}

/* Body */
body{
  min-height:100svh; /* PWA fix */
  background:linear-gradient(135deg,#dff4ff,#f7fbff,#eaf6ff);
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
  overflow:hidden;
  padding:15px;
  opacity:0;
  transition:.6s;
}

body.loaded{opacity:1;}
body.fade-out{opacity:0;}

/* Soft Animated Blobs */
body::before,
body::after{
  content:'';
  position:absolute;
  width:260px;
  height:260px;
  background:linear-gradient(135deg,#4facfe,#00f2fe,#7f7cff);
  border-radius:50%;
  filter:blur(120px);
  opacity:.35;
  animation:float 8s ease-in-out infinite alternate;
}

body::before{top:-60px;left:-60px;}
body::after{bottom:-60px;right:-60px;}

@keyframes float{
  from{transform:translateY(0);}
  to{transform:translateY(35px);}
}

/* Card */
.card{
  width:100%;
  max-width:420px;   /* Bigger on mobile */
  padding:32px 26px;
  background:rgba(255,255,255,.85);
  backdrop-filter:blur(18px);
  border-radius:24px;
  border:1px solid rgba(79,172,254,.3);

  box-shadow:
    0 12px 30px rgba(0,0,0,.15),
    0 0 30px rgba(79,172,254,.25);

  text-align:center;
  color:#05202c;

  animation:enter .8s ease;
}

/* Entry Animation */
@keyframes enter{
  from{
    opacity:0;
    transform:translateY(40px) scale(.95);
  }
  to{
    opacity:1;
    transform:translateY(0) scale(1);
  }
}

/* Title */
h2{
  margin-bottom:18px;
  font-size:24px;
  color:#0a2a36;
  text-shadow:0 0 10px rgba(79,172,254,.4);
}

/* Inputs */
input{
  width:100%;
  padding:13px;
  margin:9px 0;
  background:rgba(0,0,0,.04);
  border:1px solid rgba(79,172,254,.4);
  border-radius:14px;
  color:#05202c;
  outline:none;
  font-size:15px;
}

input:focus{
  border-color:#4facfe;
  box-shadow:0 0 10px #4facfe;
}

input::placeholder{
  color:#666;
}

/* Buttons */
button{
  width:100%;
  padding:13px;
  margin-top:10px;
  border:none;
  border-radius:14px;

  background:linear-gradient(135deg,#00f2fe,#4facfe,#7f7cff);
  background-size:200%;

  color:white;
  font-weight:700;
  font-size:15px;
  cursor:pointer;

  transition:.4s;
}

button:hover{
  background-position:right;
  box-shadow:0 0 15px #4facfe;
  transform:translateY(-2px);
}

/* Loader */
.loader{
  display:none;
  margin:12px auto;
  width:26px;
  height:26px;
  border:3px solid rgba(0,0,0,.2);
  border-top:3px solid #4facfe;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  to{transform:rotate(360deg);}
}

/* Popup */
.popup{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(0);

  background:white;
  padding:22px 32px;
  border-radius:16px;

  color:#05202c;
  font-weight:600;

  transition:.4s;
  z-index:999;

  box-shadow:0 0 25px rgba(79,172,254,.5);
}

.popup.active{
  transform:translate(-50%,-50%) scale(1);
}

/* Mobile Extra */
@media(max-width:480px){

  .card{
    padding:26px 20px;
    border-radius:20px;
  }

  h2{
    font-size:22px;
  }

}

</style>
</head>

<body>

<div class="card">

  <h2>OTP Login üîê</h2>
  <input type="text" id="name" placeholder="Enter Your Name">
  <input type="text" id="phone" placeholder="+91XXXXXXXXXX">

  <div id="recaptcha-container"></div>

  <button onclick="sendOTP()">Send OTP</button>

  <div class="loader" id="loader"></div>

  <input type="text" id="otp" placeholder="Enter OTP">

  <button onclick="verifyOTP()">Verify OTP</button>

</div>

<!-- Popup -->
<div class="popup" id="popup">‚úÖ Login Successful</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>

  var firebaseConfig = {
    apiKey: "AIzaSyDO-fBwp3X7pdEA_FJcfyKW0PEHu3asfX0",
    authDomain: "otp-login-75f51.firebaseapp.com",
    projectId: "otp-login-75f51",
    storageBucket: "otp-login-75f51.firebasestorage.app",
    messagingSenderId: "931034940344",
    appId: "1:931034940344:web:072fb650d656c38da0054d",
    measurementId: "G-ZTZYXYLE8C"
  };

  firebase.initializeApp(firebaseConfig);

  var auth = firebase.auth();
  var db = firebase.firestore();

  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
    'recaptcha-container',
    { size: 'normal' }
  );

  var loader = document.getElementById("loader");
  var popup = document.getElementById("popup");

  function showPopup(text) {
    popup.innerText = text;
    popup.classList.add("active");

    setTimeout(() => {
      popup.classList.remove("active");
    }, 2000);
  }
function formatPhoneNumber(input) {

  // Remove spaces, dashes, brackets etc
  let phone = input.replace(/\D/g, "");

  // If starts with 0 ‚Üí remove it
  if (phone.startsWith("0")) {
    phone = phone.substring(1);
  }

  // If starts with 91 and length is 12 ‚Üí add +
  if (phone.startsWith("91") && phone.length === 12) {
    phone = "+" + phone;
  }

  // If only 10 digits ‚Üí add +91
  if (phone.length === 10) {
    phone = "+91" + phone;
  }

  // If already has +91
  if (phone.length === 13 && phone.startsWith("91")) {
    phone = "+" + phone;
  }

  return phone;
}
  function sendOTP() {

var rawNumber = document.getElementById("phone").value;

var phoneNumber = formatPhoneNumber(rawNumber);
    loader.style.display = "block";

    auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
      .then(function (confirmationResult) {

        window.confirmationResult = confirmationResult;

        loader.style.display = "none";

        showPopup("üì© OTP Sent");

      }).catch(function (error) {

        loader.style.display = "none";

        alert(error.message);

      });
  }

function verifyOTP() {

  var code = document.getElementById("otp").value;

  loader.style.display = "block";

  window.confirmationResult.confirm(code)
    .then(function (result) {

      var user = result.user;
      var name = document.getElementById("name").value;

      // Save user to Firestore
    db.collection("users").doc(user.uid).set({

  name: name,
  phone: user.phoneNumber,
  uid: user.uid,
  createdAt: firebase.firestore.FieldValue.serverTimestamp(),
  lastLogin: firebase.firestore.FieldValue.serverTimestamp()

}, { merge: true })

      .then(function () {

        loader.style.display = "none";

        showPopup(" Login Success");

        setTimeout(() => {
          goToPage("dashboard.html");
        }, 1500);

      });

    })
    .catch(function () {

      loader.style.display = "none";

      alert("Wrong OTP ‚ùå");

    });
}

</script>
<script>
/* Page Fade In */
window.addEventListener("load", () => {
  document.body.classList.add("loaded");
});

/* Page Fade Out */
function goToPage(url){
  document.body.classList.add("fade-out");

  setTimeout(() => {
    window.location.href = url;
  }, 400);
}
</script>
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker
      .register("sw.js")
      .then(() => console.log("PWA Ready"))
      .catch(err => console.log(err));
  });
}
</script>
</body>
</html>
